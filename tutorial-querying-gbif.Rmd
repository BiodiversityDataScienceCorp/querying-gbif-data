---
title: "Querying GBIF data from rstudio.cloud"
output: pdf_document
---

Your Name Here  
DSCI 245 / RNR 496B  
January 25th, 2022  

## Querying Data from GBIF


### Learning Outcomes 
* Understand (roughly) what an API is.
* Gain some familiarity with GBIF.
* Learn how to query data from GBIF with R code.
* Ask (and answer) some basic questions about your data.


### Application Programming Interfaces (API)

Perhaps one of the best things about the internet is the existence of APIs. An API is basically a way to programmatically ask for data from a particular data source, provided you follow their rules (i.e. read their documentation).

A very common way to do this is by asking a question with a URL, and getting a response in some data format (XML, JSON, an image, etc.).

One basic example is the "Dog API" (https://dog.ceo/dog-api/). From reading their documentation, I can ask for a random image of a Cocker Spaniel with this URL:

https://dog.ceo/api/breed/spaniel/cocker/images/random

The response is a JSON (JavaScript Object Notation), which includes the URL of an image of a Cocker Spaniel. Neat!


You may be asking "so what?". Well, with the existence of APIs, we can query data sets directly from rstudio.cloud, and then write R code to work with it. This can be a little more efficient than the "download/upload" method we did last week. 



### GBIF

GBIF (Global Biodiversity Information Facility) "is an international network and data infrastructure funded by the world's governments and aimed at providing anyone, anywhere, open access to data about all types of life on Earth." Academics performing research on species distribution can upload their data to GBIF using the "Darwin Core" metadata standard (https://dwc.tdwg.org/). This means that when researchers upload their data, they're all using the same fields. What is the value in doing this?

GBIF also provides an API, so people can programmatically query data with code. Even better, developers at "rOpenSci" have created an R package call spocc (SPecies OCCurrence) that lets you directly query data from within rstudio.cloud.

### Using spocc to query GBIF
https://rsh249.github.io/bioinformatics/primary_biodiv.html

First, let's load the spocc library:

```{r}
library(spocc)

```

In our case, we're not going to be constructing URLs, but we'll be using an R package called "spocc". spocc has some built-in functions we can use to directly query data from the Global Biodiversity Information Facility (GBIF).







```{r}
spdist <- occ(query='Danaus plexippus', from='gbif', limit=5000)

gbif<-spdist$gbif

gbif

```

```{r}
df = as.data.frame(occ2df(spdist$gbif))
df

az<-dplyr::filter(df, stateProvince=="Arizona")
az

```



possible querying problems:

Using:
https://docs.ropensci.org/spocc/reference/occ.html
https://anthonylouisdagostino.com/bounding-boxes-for-all-us-states/

Query monarch butterflies in Arizona (hint, use 'geometry' argument)





### Looking at your data




















```{r}
library(mapr)
map_leaflet(az)
```






